<div class="container-fluid block-info">
    <div class="row">
        <div class="block-name">
            {{descriptor.name | uppercase}}
        </div>
    </div>
    <div class="row mt-1">
        <div class="block-description">
            {{descriptor.description}}
        </div>
    </div>
    <div class="row mt-1" *ngIf="descriptor.extraInfo !== ''">
        <div class="block-extra-info">
            {{descriptor.extraInfo}}
        </div>
    </div>

    <!-- From now on, other settings depend on the type of block -->
    <ng-container *ngIf="block.type === BlockInstanceType.Auto">
        <div class="row mt-1">
            <div class="mb-1">
                <span class="text-small">Label</span>
            </div>
            <app-input-text key="blockLabel"
                class="input-small w-100"
                ngDefaultControl
                (validityChange)="valueChanged()"
                [(ngModel)]="block.label"
                [placeholder]="descriptor.name" />
        </div>
        <div class="row mt-2">
            <p-checkbox inputId="safeMode"
                class="text-small"
                (onChange)="valueChanged()"
                ngDefaultControl 
                [(ngModel)]="block.safe"
                [binary]="true"
                pTooltip="If safe mode is enabled, any error generated by this block will be caught and written to the data.ERROR variable, without producing an ERROR status in the bot"
                label="Safe Mode" />
        </div>
        <div class="row mt-2" *ngIf="descriptor.returnType !== null">
            <div class="mb-1">
                <span class="text-small">Output variable ({{descriptor.returnType | pascalcase}})</span>
            </div>
            <app-input-text key="outputVariableName"
                class="input-small w-100"
                ngDefaultControl
                (validityChange)="valueChanged()"
                [(ngModel)]="block.outputVariable"
                placeholder="myVar" />
        </div>
        <div class="row mt-2" *ngIf="descriptor.returnType !== null">
            <p-checkbox inputId="isCapture"
                class="text-small"
                (onChange)="valueChanged()"
                ngDefaultControl 
                [(ngModel)]="block.isCapture"
                [binary]="true"
                pTooltip="If checked, the output variable will be marked for capture"
                label="Is Capture" />
        </div>
        <div class="row mt-3" *ngIf="Object.keys(block.settings).length > 0">
            <div class="color-accent-light text-small">
                PARAMETERS
            </div>
        </div>
        <div class="row mt-2" *ngFor="let setting of Object.values(block.settings)">
            <div class="col-12 px-0">
                <div class="mb-1">
                    <span
                        *ngIf="setting.type !== BlockSettingType.Bool"
                        class="text-small">
                        {{setting.name | pascalcase}} {{setting.type === BlockSettingType.ByteArray ? '(Base 64)' : ''}}
                    </span>
                    <app-bool-setting
                        *ngIf="setting.type === BlockSettingType.Bool"
                        [parameter]="descriptor.parameters[setting.name]"
                        [setting]="setting"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                    <app-int-setting
                        *ngIf="setting.type === BlockSettingType.Int"
                        [parameter]="descriptor.parameters[setting.name]"
                        [setting]="setting"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                    <app-float-setting
                        *ngIf="setting.type === BlockSettingType.Float"
                        [parameter]="descriptor.parameters[setting.name]"
                        [setting]="setting"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                    <app-string-setting
                        *ngIf="setting.type === BlockSettingType.String"
                        [parameter]="descriptor.parameters[setting.name]"
                        [setting]="setting"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                    <app-enum-setting
                        *ngIf="setting.type === BlockSettingType.Enum"
                        [parameter]="descriptor.parameters[setting.name]"
                        [setting]="setting"
                        (onChange)="valueChanged()" />
                    <app-byte-array-setting
                        *ngIf="setting.type === BlockSettingType.ByteArray"
                        [parameter]="descriptor.parameters[setting.name]"
                        [setting]="setting"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                    <app-list-of-strings-setting
                        *ngIf="setting.type === BlockSettingType.ListOfStrings"
                        [parameter]="descriptor.parameters[setting.name]"
                        [setting]="setting"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                    <app-dictionary-of-strings-setting
                        *ngIf="setting.type === BlockSettingType.DictionaryOfStrings"
                        [parameter]="descriptor.parameters[setting.name]"
                        [setting]="setting"
                        [stacker]="stacker"
                        (onChange)="valueChanged()" />
                </div>
            </div>
        </div>
    </ng-container>
    <ng-container *ngIf="block.type === BlockInstanceType.Parse">
        <app-parse-block
            [block]="block"
            [descriptor]="descriptor"
            [stacker]="stacker"
            (onChange)="valueChanged()" />
    </ng-container>
    <ng-container *ngIf="block.type === BlockInstanceType.LoliCode">
        <app-lolicode-block
            [block]="block"
            [descriptor]="descriptor"
            (onChange)="valueChanged()" />
    </ng-container>
    <ng-container *ngIf="block.type === BlockInstanceType.Script">
        <app-script-block
            [block]="block"
            [descriptor]="descriptor"
            (onChange)="valueChanged()" />
    </ng-container>
    <ng-container *ngIf="block.type === BlockInstanceType.Keycheck">
        <app-keycheck-block
            [envSettings]="envSettings"
            [block]="block"
            [descriptor]="descriptor"
            [stacker]="stacker"
            (onChange)="valueChanged()" />
    </ng-container>
    <ng-container *ngIf="block.type === BlockInstanceType.HttpRequest">
        <app-http-request-block
            [block]="block"
            [descriptor]="descriptor"
            [stacker]="stacker"
            (onChange)="valueChanged()" />
    </ng-container>
</div>
